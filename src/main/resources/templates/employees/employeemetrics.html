<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.4.0/chart.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
   
    <title>Headcount View</title>
</head>
<body>


    <div class = "container"> 
        <canvas id = "headcount"></canvas>
    </div>


    <script th:inline="javascript">  
    

        

        let test = [];
        var theList = [[${employees}]]
        for (i = 0; i < theList.length; i++) {
            test.push(theList[i].name);
        }
        /*
        let currentTime = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();

        today = yyyy + "-" + mm + "-" + dd;

        let endtime = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate());

        var times = [currentTime, endTime];
        console.log(currentTime);
        console.log(endTime);
        */
        var now = new Date(2021, 7, 21);
        var daysOfYear = [];
        for (var d = new Date(2021, 4, 1); d <= now; d.setDate(d.getDate() + 7)) {
            console.log(d.getDate());
            let x = d.getDate();
            let y = d.getMonth();
            let z = d.getFullYear();
            let abc = y + "/" + x + "/" + z;
            daysOfYear.push(abc);
        }

    


    



        let headcount = document.getElementById('headcount').getContext('2d');

        let myChart = new Chart(headcount, {
            //type of line we want to create
            type: 'line',

             //the data of our dataset
            data: {
                labels: daysOfYear, //[jan 1, jan 7, jan 15, jan 22],
                datasets: [{
                    label: 'Headcount: Planning',
                    
                    data: [10, 50, 25, 70, 40],
                    backgroundColor:'orange',
                    borderColor: 'orange',
                    fill: false,
                    pointRadius: 5
                },

                {
                    label: 'Headcount: Confirmed',
                    data: [20,35,40,60,50],
                    backgroundColor:'blue',
                    borderColor: 'blue',
                    fill: false,
                    pointRadius: 5
                }]
            },
            options: {
                scales:{
                    yAxes:{
                        title: {
                            display: true,
                            text: "Headcount",
                            font: {
                                size: 25
                            },
                        }
                    },
                    xAxes:{
                        title: {
                            display: true,
                            text: "Date",
                            font: {
                                size: 25
                            }                      
                        }
                    }
                },
                plugins:{
                    legend:{
                        position: 'bottom',
                        labels:{
                            padding:50
                        }
                    },
                    title: {
                        display: true,
                        text: 'Headcount View',
                        font: {
                                size: 50
                        }
                    }
                }
            }
        });*/

        const ctx = document.getElementById('headcount').getContext('2d');

        const startDate = new Date(2021, 6, 05);
        const labels = [];

        let i = 0;
        let date = new Date();

        for (i; i < 52; i++) {
        date = moment(startDate).add(i, 'weeks').format('YYYY/MM/DD');  
        labels.push(date.toString());
        }

        const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels,
            datasets: [{
                label: 'Headcount: Planning',
                data: [10, 50, 25, 70, 40],
                backgroundColor:'orange',
                borderColor: 'orange',
                borderWidth: 1,
                tension: 0.3,
                fill: false
            },
            {
                label: 'Headcount: Confirmed',
                data: [20,35,40,60,50],
                backgroundColor:'blue',
                borderColor: 'blue',
                borderWidth: 1,
                tension: 0.3,
                fill: false
             
            }]
        },
        options: {
            scales: {   //watch out here - new syntax in v3.xx
            x: {
                type: 'timeseries',
                time: {
                    unit: 'week',  //this does the trick :-)
                    isoWeekday: true,
                        // declare Monday as the first day of the week
                        // because in some locale, sunday would be first day of week
                }
            }
            }
        }
        });
        
        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function removeData(chart) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update();
        }

    


    </script>

    
</body>
</html>