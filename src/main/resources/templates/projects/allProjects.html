<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::header})}"></html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/stylesheets/allEmployees.css" />

    <title>Current Projects</title>
</head>

<header></header>

<body>
    <div class="container">
      <form action="#" method="post" th:action="@{/projects}" th:object="${property}">
        <label>Search by</label> 
        <select name="filterBy" id="filterBy">
            <optgroup th:field=*{filterBy}>
              <option value="">Select...</option>
                <option value="name">Name</option>
                <option value="startdate">Start Date</option>
                <option value="enddate">End Date</option>
            </optgroup>
        </select>

        <label>Search value</label>
        <input type="text" th:field="*{value}" id="value">

        <input type="submit" value="Search">
        <button class="cancel"><a th:href="@{/projects}">Unfilter</a></button>   
      </form>
    </div>
  
    
    <div class="data-table">
      <table id="myTable">
          <thead>
            <tr>
              <th>Name of Project</th>     
              <th>Start Date</th>
              <th>End Date</th>
              <th></th>
              <th></th>
            </tr>
          </thead>

          <tbody>
            <tr th:each="project : ${projects}">
              <td th:text="${project.name}"></td>
              <td th:text="${project.start}"></td>
              <td th:text="${project.end}"></td>
              
              <td>
                <button>View</button>
              </td>
              <td>
                <button>Edit</button>
              </td>
              <td>
                <button><a th:href="@{/projects/deleted?p_id={id}(id=${project.id})}"><i class="bi bi-trash"></i>Delete</a></button>
              </td>
            </tr>
      
          </tbody>
      </table>
    </div>


  <script>

    let attr;
    let filterBy = document.getElementById("filterBy");  
    filterBy.addEventListener("click", getAttribute);

    let value = document.getElementById("value");
    value.addEventListener("keyup", getFilter)
    
    function getAttribute() {
      let val = filterBy.value;
      //console.log(val);
      if (val == "name") {
        attr = 0;
      }
      else if (val == "startdate") {
        attr = 1;
      }
      else if (val == "enddate") {
        attr = 2;
      }
      else {
        attr = 3;    
      }
      //console.log(attr);
    }

    function getFilter() {
      if (attr == 3) {
        return;
      }
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("value");
      filter = input.value.toUpperCase();
      table = document.getElementById("myTable");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[attr];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }       
      }
    }

</script>

</body>

</html>